Цель:
Привести пример успешной адаптации ClickHouse, описать закрытую бизнес-потребность
Данная домашняя работа направлена на дополнительное самостоятельное изучение кейсов применения БД ClickHouse для ознакомления со спецификой использования в проектах


Описание/Пошаговая инструкция выполнения домашнего задания:
1. Привести 2 - 3 практических примера использования БД ClickHouse в компаниях
2. Уточнить специфику проекта
3. Подготовить отчет со ссылками на ресурсы

Ответ:

Из практики: 
1. Работаю в компании Wildberries, у нас есть несколько кликхаусов, каждый используется под свои задачи. Так как компания достаточно крупная - соответственно, и поток данных достаточно большой. В моем подразделении мы в основном анализируем данные, связанные с движением товара. Данные поступают через кафку. Так что в основном используем следующую структуру (следующие схемы (databases))
- streams - здесь хранятся таблицы-консьюмеры с движком KafkaEngine
- raw - здесь лежат МВ (matherialized view), которые смотрят на таблицы из streams, и сюда же складываются данные из них. Данные в основном лежат в строковом виде + несколько виртуальных колонок. Таблицы партиционированы и на них есть ттл, что позволяет проблем с заканчивающимся местом.
- далее данные из raw-таблиц раскладываются через МВ по конкретным схемам (тут зависит от сущности), в таблицы с ддл под конкретную задачу - есть и MergeTree, и ReplacingMT
- есть еще схема под витрины, витрины собиратся оркестратором (Airflow)
- есть служебные схемы, например, под словари

Таким образом:
- вставка идет постоянно через специальный, подходящий для этой задачи движок. Данные не удаляются/не изменяются, а только вставляются
- под специфические задачи (отчеты) строятся витрины и обновляются оркестратором - позволяет избегать нагрузки со стороны BI
- активно используем кластеры - например, на один кластер данные пишутся, на другой идут запросы от BI, так даже в случае увеличенной нагрузки со стороны BI у нас данные все равно будут записываться
- так как кликхаусов несколько и они разбиты каждый под свою задачу - в случае необходимости можно легко перегонять данные через табличную функцию remote

Это пример хорошего (на мой взгляд) использования Кликхауса

2. Также работаю в компании Нетология. У нас есть Вертика и Кликхаус в качестве аналитических БД. Так как Вертика ограничена 1Тб сырых данных (бесплатная лицензия) - аналитики начали переезд на кликхаус, при этом подход к построению витрин остался тем же (с кучей джоинов). Также данные вставляются в Кликхаус из апи (и обновляются/удаляются, что есть полнейший харам), еще есть кликстрим (большая таблица, куда данные летят из кафки). Это пример плохого использования кликхауса. Поэтому в планах:
- вынести сборку витрин за пределы кликхауса (либо в другой БД, либо с использованием спарка)
- навесить на кликстрим несколько МВ, чтобы работать не с ним, а с таблицами на его основе (с, возможно, другим order by)
- вынести таблицы, куда летят данные из апи, в другую БД. Данные из этих таблиц переносить раз в день оркестратором (внешние таблицы не получается использовать, тк базы в разных сетевых контурах, так что приходится в них ходить через туннель)

Дополнительно приложить ответы на вопросы из лекции:
1. К каким классам систем относится ClickHouse?

OLAP, MPP

2. Какую проблему вы бы решили используя ClickHouse, а какую бы не стали?
- стал бы:
  - построение аналитических витрин , данные из которых будут получаться за счет агрегаций (олап кубы и тд)
  - хранение кликстримов
  - хранение исторических данных (клик хорошо жмет за счет колоночного хранения и возможности использовать разные кодеки сжатия + есть ттл, можно старые данные скидывать в холодное хранилище, например на s3 или на другой диск, более медленный) [ссылка](https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/mergetree#table_engine-mergetree-multiple-volumes)
- не стал бы
  - работа с транзакциями и в целом с ACID
  - построение витрин за счет сложной логики в самом кликхаусе (sql-полотна на 1500 строк с огромным количеством джоинов)

3. Где можно получить помощь по ClickHouse и куда сообщать о багах?

Телеграм, "кликхаус не тормозит". Предварительно консультируюь там, в случае если там подтвердят баг - можно завести ишью в гитхабе Кликхауса